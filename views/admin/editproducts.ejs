<%- include('../layouts/admin/header.ejs') -%>


    <div class="screen-overlay"></div>
    <aside class="navbar-aside" id="offcanvas_aside">
        <div class="aside-top">
            <a class="brand-wrap">
                <img style="width: 50px;" src="/img/logoleo.jpg" alt="Nest Dashboard" />
            </a>
            <div>
                <button class="btn btn-icon btn-aside-minimize"><i
                        class="text-muted material-icons md-menu_open"></i></button>
            </div>
        </div>
        <nav>
            <ul class="menu-aside">
                <li class="menu-item ">
                    <a class="menu-link" href="/admin/adminDashboard">
                        <i class="icon material-icons md-home"></i>
                        <span class="text">Dashboard</span>
                    </a>
                </li>
                <li class="menu-item active">
                    <a class="menu-link" href="/admin/products">
                        <i class="icon material-icons md-shopping_bag"></i>
                        <span class="text">Products</span>
                    </a>
                </li>
                <li class="menu-item ">
                    <a class="menu-link" href="/admin/ums">
                        <i class="icon material-icons md-person"></i>
                        <span class="text">User management</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a class="menu-link" href="/admin/category">
                        <i class="icon material-icons md-store"></i>
                        <span class="text">Categories</span>
                    </a>
                </li>
                <li class="menu-item ">
                    <a class="menu-link" href="">
                        <i class="icon material-icons md-shopping_cart"></i>
                        <span class="text">Orders</span>
                    </a>
                </li>
                <li class="menu-item ">
                    <a class="menu-link" href="page-transactions-1.html">
                        <i class="icon material-icons md-monetization_on"></i>
                        <span class="text">Coupons</span>
                    </a>

                </li>
                <li class="menu-item ">
                    <a class="menu-link" href="#">
                        <i class="icon material-icons md-monetization_on"></i>
                        <span class="text">Banners</span>
                    </a>
                </li>
                </li>
            </ul>
            <br />
            <br />
        </nav>
    </aside>
    <main class="main-wrap">
        <header class="main-header navbar">
            <div class="col-search">
                <form class="searchform">
                    <div class="input-group">
                        <input list="search_terms" type="text" class="form-control" placeholder="Search term" />
                        <button class="btn btn-light bg" type="button"><i class="material-icons md-search"></i></button>
                    </div>

                </form>
            </div>
            <div class="col-nav">
                <a href="/admin"><i class="btn btn-dark ms-3 rounded-pill">Logout</i></a>
                <button class="btn btn-icon btn-mobile me-auto" data-trigger="#offcanvas_aside"><i
                        class="material-icons md-apps"></i></button>
                <ul class="nav">

                    <li class="dropdown nav-item">
                        <a class="dropdown-toggle" data-bs-toggle="dropdown" href="#" id="dropdownAccount"
                            aria-expanded="false"> <img class="img-xs rounded-circle" src="/imgs/people/avatar-2.png"
                                alt="User" /></a>
                        <div class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownAccount">

                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item text-danger" href=""><i
                                    class="material-icons md-exit_to_app"></i>Logout</a>
                        </div>
                    </li>
                </ul>
            </div>

        </header>

        <section class="d-flex justify-content-center align-items-center p-4">
            <div class="col col-md-8 col-lg-6 col-xxl-5">
                <h1 class="text-center fw-bold mb-5 fs-2"
                    style="font-family: Arial, Helvetica, sans-serif; font-weight: bold;">Edit product</h1>

                <!-- Your complete product addition form here -->
                <form action="/admin/editproducts" method="post" enctype="multipart/form-data"
                    onsubmit="return validate()">
                    <input type="hidden" name="id" value="<%= products._id %>">
                    <div class="form-group">
                        <label for="product_title">Product Name</label>
                        <input type="text" class="form-control" id="product_title" name="name"
                            value="<%= products.name %>" required>
                    </div>
                    <div id="pronameErr" class="forml" style="color: red;"></div>

                    <div class="form-group">
                        <label for="quantity">Quantity</label>
                        <input type="number" class="form-control" id="quantity" name="quantity"
                            value="<%= products.stockQuantity%>" required>
                        <div id="quantityErr" class="forml" style="color: red;"></div>
                    </div>
                    <div class="form-group">
                        <label for="product-category">Category</label>
                        <select class="form-control" id="product-category" name="category" required>

                            <% for (let i=0; i < categories.length; i++) { %>
                                <option value="<%= categories[i]._id %>">
                                    <%= categories[i].name %>
                                </option>
                                <% } %>
                        </select>
                    </div>
                    <div id="cateErr" class="forml" style="color: red;"></div>

                    <div class="row " style="margin-left: 1rem; margin-bottom: 1rem;">
                        <label>Edit size</label>
                        <div class="form-check col-lg-2">
                            <input class="form-check-input" name="sizes" type="checkbox" value="S" id="defaultCheck1">
                            <label class="form-check-label" for="defaultCheck1">
                                S
                            </label>
                        </div>
                        <div class="form-check col-lg-2">
                            <input class="form-check-input" name="sizes" type="checkbox" value="M" id="defaultCheck1">
                            <label class="form-check-label" for="defaultCheck1">
                                M
                            </label>
                        </div>
                        <div class="form-check col-lg-2">
                            <input class="form-check-input" name="sizes" type="checkbox" value="L" id="defaultCheck1">
                            <label class="form-check-label" for="defaultCheck1">
                                L
                            </label>
                        </div>
                        <div class="form-check col-lg-2">
                            <input class="form-check-input" name="sizes" type="checkbox" value="XL" id="defaultCheck1">
                            <label class="form-check-label" for="defaultCheck1">
                                XL
                            </label>
                        </div>
                        <div class="form-check col-lg-2">
                            <input class="form-check-input" name="sizes" type="checkbox" value="XXL" id="defaultCheck1">
                            <label class="form-check-label" for="defaultCheck1">
                                XXL
                            </label>
                        </div>
                    </div>


                    <label>Price</label>
                    <div class="form-group">
                        <label for="price">
                            <%= products.price %>
                        </label>
                        <input type="text" class="form-control" id="price" name="price" value="<%= products.price %>"
                            required>
                    </div>
                    <div id="priceErr" class="forml" style="color: red;"></div>
                    <label>Previous price</label>
                    <div class="form-group">
                        <label for="previousPrice">
                            <%= products.previousPrice %>
                        </label>
                        <input type="text" class="form-control" id="previousPrice" name="previousPrice"
                            value="<%= products.previousPrice %>" required>
                    </div>
                    <div id="previouspriceErr" class="forml" style="color: red;"></div>
                    <div class="form-group">
                        <label for="description">Description</label>
                        <textarea class="form-control" id="description" name="description" rows="4"
                            required><%= products.description %></textarea>
                    </div>
                    <div id="descriptionErr" class="forml" style="color: red;"></div>

                    <div class="form-group">
                        <label>Product Images</label>
                        <div class="row">

                            <div class="col-lg-12 col-md-12 mb-3 rounded-image-preview">
                                <label for="imageInput" class="image-label"> image
                                    <div class="rounded-image-preview">
                                        <% for(let i=0;i < 3;i++){%>
                                            <img id="previewImage"
                                                src="/assets/img/product/sharp/<%= products.images[i] %>" alt="Preview">
                                            <!-- Provide a default image or placeholder here if needed -->
                                            <input name="images" type="file" accept="image/*" id="imageInput"
                                                class="imageInput" onchange="previewImage(this, 'previewImage')">
                                </label>
                                <!-- <img id="previewImage" src="/path/to/default-image.jpg" alt="Default Preview"> -->

                                <%}%>

                            </div>
                        </div>

                    </div>
            </div>


            <div class="form-group mt-3">
                <button type="submit" class="btn btn-primary">Submit</button>
                <div class="mt- 4">

                    <a href="/admin/products" class="btn btn-primary  mt- 4">
                        <span class=" mt- 4">Back</span>
                    </a>
                </div>
            </div>
            </form>
            </div>
            <script>
                function previewImage(input, Imageid) {
                    const preview = document.getElementById(Imageid)
                    const files = input.files[0];
                    if (files) {

                        const reader = new FileReader();
                        reader.onload = function (e) {
                            preview.src = e.target.result
                        }
                        reader.readAsDataURL(files)
                    } else {
                        preview.src = '/assets/images/add Image.jpg';
                    }
                }
            </script>



            <script>
                function validate() {
                    let proname = document.getElementById('product_title');
                    let quantity = document.getElementById('quantity');
                    let price = document.getElementById('price');
                    let previousprice = document.getElementById('previousPrice');
                    let description = document.getElementById('description');
                    let category = document.getElementById('product-category'); // Correct the ID here
                    let quantityErr = document.getElementById('quantityErr'); // Add this line

                    // let cateErr = document.getElementById('cateErr'); // Add this line

                    if (proname.value.trim() === '') {
                        proname.style.border = 'solid 1px red';
                        quantityErr.textContent = "must give product name"; // Correct the variable name here
                        setTimeout(function () {
                            proname.style.border = '';
                            quantityErr.textContent = '';
                        }, 4000);
                        return false;
                    } else if (category.value.trim() === '') {
                        category.style.border = 'solid 1px red';
                        quantityErr.textContent = "must give category name"; // Correct the variable name here
                        setTimeout(function () {
                            category.style.border = '';
                            quantityErr.textContent = '';
                        }, 4000);
                        return false;
                    } else if (quantity.value.trim() === '' || Number(quantity.value) <= 0 || isNaN(quantity.value)) {
                        quantity.style.border = 'solid 1px red';
                        quantityErr.textContent = "quantity must be more than 0";
                        setTimeout(function () {
                            quantity.style.border = '';
                            quantityErr.textContent = '';
                        }, 4000);
                        return false;
                    } else if (price.value.trim() === '' || Number(price.value) <= 0 || isNaN(price.value)) {
                        price.style.border = 'solid 1px red';
                        quantityErr.textContent = "price must be more than 0"; // Correct the variable name here
                        setTimeout(function () {
                            price.style.border = '';
                            quantityErr.textContent = '';
                        }, 4000);
                        return false;
                    } else if (previousprice.value.trim() === '' || Number(previousprice.value) <= 0 || isNaN(previousprice.value)) {
                        previousprice.style.border = 'solid 1px red';
                        quantityErr.textContent = "give here previous price"; // Correct the variable name here
                        setTimeout(function () {
                            previousprice.style.border = '';
                            quantityErr.textContent = '';
                        }, 4000);
                        return false;
                    } else if (description.value.trim() === '' || description.value.trim().length <= 20) {
                        description.style.border = 'solid 1px red';
                        quantityErr.textContent = "Description must be more than 20 letters"; // Correct the variable name here
                        setTimeout(function () {
                            description.style.border = '';
                            quantityErr.textContent = '';
                        }, 4000);
                        return false;
                    } else {
                        return true; // Correct the syntax here
                    }
                }
            </script>
            
            <%- include('../layouts/admin/footer.ejs') -%>