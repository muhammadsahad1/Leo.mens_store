<%- include('../layouts/user/header.ejs') -%>

  <style>
    .containerrr {
      display: flex;
      flex-wrap: wrap;
    }

    .sidebarrr {
      flex: 1;
      min-width: 20%;
      max-width: 25%;
      padding: 20px;

      color: #fff;
      min-height: 100vh;
    }

    .main-contenttt {
      flex: 3;
      padding: 20px;
    }

    hr {
      color: black;
    }

    .user-headerrr {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
    }

    .user-photooo {
      border-radius: 50%;
      width: 40px;
      height: 40px;
      margin-right: 10px;
      /* Placeholder background color for the user photo */
      background-color: #ddd;
    }

    .user-nameee {
      font-size: .6rem;
      font-weight: bold;
    }

    .menu-headinggg {
      font-size: .7rem;
      font-weight: bold;
      margin-bottom: 10px;
      color: rgba(127, 127, 127, 1);
    }

    .menu-itemmm {
      margin-bottom: 10px;

    }

    .menu-itemmm a {
      color: black;
      text-decoration: none;
      font-size: .9rem;
      font-family: 'Quicksand';
    }

    .menu-itemmm.selected {
      background-color: #f0f0f0;
      border-radius: 5px;
    }

    @media screen and (max-width: 600px) {
      .menu-itemmm a {
        color: black;
        text-decoration: none;
        font-size: .5rem;
      }

    }




    /* wallet  */
    .card {
      border: none;
      border-radius: 10px;
      width: 50%;


    }

    .fa-ellipsis-v {
      font-size: 10px;
      color: #C2C2C4;
      margin-top: 6px;
      cursor: pointer;
    }

    .text-dark {
      font-weight: bold;
      margin-top: 8px;
      font-size: 13px;
      letter-spacing: 0.5px;
    }

    .card-bottom {
      background: #3E454D;
      border-radius: 6px;
    }

    .flex-column p {
      letter-spacing: 1px;
      font-size: 18px;
    }

    .btn-secondary {
      height: 40px !important;
      margin-top: 3px;
    }

    .btn-secondary:focus {
      box-shadow: none;
    }
  </style>
  </head>

  <body>


    <header class="header">
      <div class="header__top">
          <div class="container">
              <div class="row">
                  <div class="col-lg-6 col-md-7">
                      <div class="header__top__left">
                          <p></p>
                      </div>
                  </div>
                  <div class="col-lg-6 col-md-5">
                      <div class="header__top__right">
                          <div class="header__top__links">
                              <a href="/register">Sign in</a>
                              <a href="#">FAQs</a>
                          </div>
                          <div class="header__top__hover">
                              <span>Usd <i class="arrow_carrot-down"></i></span>
                              <ul>
                                  <li>USD</li>
                                  <li>EUR</li>
                                  <li>USD</li>
                              </ul>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
      </div>
      <div class="container">
          <div class="row">
              <div class="col-lg-3 col-md-3" style="height: 50px;">
                  <div class="header__logo">
                      <a href="/"><img src="/img/logoleo.jpg" style="width: 80px;" alt=""></a>
                  </div>
              </div>
              <div class="col-lg-6 col-md-6">
                  <nav class="header__menu mobile-menu">
                      <ul>
                          <li class="active"><a href="">Home</a></li>
                          <li><a href="/productsshop ">Shop</a></li>
                          <li><a href="#">Pages</a>
                              <ul class="dropdown">
                                  <li><a href="/about">
                                    about
                              </ul>
                          </li>
                          
                          <li><a href="/contact">Contacts</a></li>
                      </ul>
                  </nav>
              </div>
              <div class="col-lg-3 col-md-3">
                <div class="header__nav__option">
                    <div class="dropdown">
                        <a class="dropdown-toggle" href="#" role="button" id="userDropdown"
                            data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <% if(locals.user){ %>
                                <img style="width: 17px;" src="/img/icon/person.png" alt="User Profile">
                                <a href="/Cartpage">
                                    <img src="/img/icon/cart.png" alt="">
                                    <!-- Corrected: Using locals.cartCount for cart items -->
                                    <span class="badge badge-primary mt-1 ms-1" id="cartBadge"><%= locals.cartCount %></span>
                                </a>
                                <% } else { %>
                                    <img style="width: 17px;" src="/img/icon/person.png" alt="">
                                    <% } %>
                        </a>
                
                        <div class="dropdown-menu" aria-labelledby="userDropdown">
                            <% if(locals.user){ %>
                                <a class="dropdown-item" href="/Userprofile">My Profile</a>
                                <a class="dropdown-item" href="/logout">Logout</a>
                                <% } else { %>
                                    <a class="dropdown-item" href="/login">Login</a>
                                    <a class="dropdown-item" href="/register">Sign up</a>
                                    <% } %>
                        </div>
                
                        <a href="#" class="search-switch"><img src="img/icon/search.png" alt=""></a>
                        <% if(locals.user){ %>
                        <a href="/wishlist">
                            <img src="img/icon/heart.png" alt="">
                            <!-- Corrected: Using locals.wishlitCount for wishlist items -->
                            <span class="badge badge-danger mt-1 ms-1" id="wishlistBadge"><%=locals.wishlitCount%></span>
                        </a>
                        <% } %>
                    </div>
                </div>
            </div>
        </div>
        <div class="offcanvas-menu-overlay"></div>
        <div class="offcanvas-menu-wrapper">
            <div class="offcanvas__nav__option">
                <a href="/wishlist"><img src="img/icon/heart.png" >
                    <span class="badge badge-danger mt-1 ms-1" id="wishlistBadge"><%=locals.wishlitCount%></span>
                            <a href="/Cartpage"><img src="/img/icon/cart.png" alt=""> 
                                <span class="badge badge-primary mt-1 ms-1" id="cartBadge"><%= locals.cartCount %></span>
                            <%if(locals.user){%>
                                <a href="/Userprofile"><i class="fa-regular fa-user fa-lg"></i></a>
                                <a href="/logout"class="btn btn-dark">Logout</a>
                            <%} else {%>
                                <a href="/login"><i class="fa-regular fa-user fa-lg"></i></a>
                                <a href="/login" class="btn btn-dark">Login</a>
                            <%}%>
            </div>
  </header>


    <body>

      <div class="containerrr">
        <!-- Sidebar -->
        <div class="sidebarrr" id="sidebar">
          <div class="user-headerrr">
            <div class="user-photooo"></div>
            <div class="user-nameee">
              <!-- User name or other user-related information -->
            </div>
          </div>

          <!-- Sidebar Menu -->
          <div class="menu-headinggg">General</div>
          <div class="menu-itemmm"><a href="/manageAddress" aria-current="page" class="bg-light active">Manage
              Address</a></div>
          <hr>
          <div class="menu-itemmm"><a href="/myOrder">Orders</a></div>
          <hr>
          <div class="menu-itemmm"><a href="#">Wishlist</a></div>
          <hr>
          <div class="menu-itemmm"><a href="/wallet">Wallet</a></div>
          <hr>

          <div class="menu-headinggg">Legal</div>
          <div class="menu-itemmm"><a href="#">Terms of Use</a></div>
          <hr>
          <div class="menu-itemmm"><a href="#">Privacy Policy</a></div>
          <hr>

          <div class="menu-headinggg">Personal</div>
          <div class="menu-itemmm"><a href="#">Report a Bug</a></div>
          <hr>
          <div class="menu-itemmm"><a href="/logout">Logout</a></div>
          <hr>
        </div>

        <!-- Main Content -->
        <div class="main-contenttt">
          <div class="container py-5">
            <div class="row">
              <div class="col">
                <nav aria-label="breadcrumb" class=" rounded-3 p-3 mb-4 ">
                  <ol class="breadcrumb mb-0 ">
                    <li class="breadcrumb-item"><a href="/" style="color: black;">Home</a></li>
                    <li class="breadcrumb-item active " aria-current="page"><a href="/Userprofile"
                        style="color: black;">User Profile</a></li>
                  </ol>
                </nav>
              </div>
            </div>
            <div class="row">
              <div class="col-md-12 mb-4">
                <!-- Wallet Section -->
                <div id="edit-profile-section " style="display: block;">
                  <div class="mt-5">
                    <h1 class="">Your Wallet</h1>
                    <div class="table-responsive">
                      <div class="d-flex ">
                        <div class="card p-3">
                          <div class="d-flex flex-row justify-content-between text-align-center">
                            <i class="fas fa-ellipsis-v"></i>
                          </div>
                          <div class="card-bottom pt-3 px-3 mb-2">
                            <div class="d-flex flex-row justify-content-between text-align-center">
                              <div class="d-flex flex-column" style="color: #adb5bd; font-size: 13px;">
                                <span>Balance amount</span>
                                <p>₹ <span class="text-white">
                                    <%=walletAmount%>
                                  </span></p>
                              </div>
                            </div>
                          </div>
                          <div class="new-div">
                            <div class="car">
                              <div class="card-body">
                                <h4 class="card-title text-center">Transaction History</h4>
                                <hr>
                                <table class="table">
                                  <thead>
                                    <tr>
                                      <th>Date</th>
                                      <th>Amount</th>
                                      <th>Type</th>
                                      <th>Reason</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <% walletHistory.forEach((history)=> { %>
                                      <%console.log("walletHistory.type",history.type)%>
                                        <tr>
                                          <% const formattedDate=new Date(history.date); %>
                                            <td>
                                              <%= formattedDate.toLocaleDateString('en-US') %>
                                            </td>
                                            <td>₹ <%= history.amount %>
                                            </td>
                                            <td>
                                              <%= history.type %>
                                            </td> <!-- Display the 'type' field -->
                                            <td>
                                              <%= history.reason %>
                                            </td>
                                        </tr>
                                        <% }) %>
                                  </tbody>
                                </table>
                                <div class="input-group mb-3">
                                  <input type="number" class="form-control" id="priceInput" placeholder="Enter price">
                                  <button class="btn btn-outline-secondary" type="button" id="openModalButton">Add
                                    Money</button>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>


          </div>

          <div class="modal fade" id="addMoneyModal" tabindex="-1" aria-labelledby="addMoneyModalLabel"
            aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="addMoneyModalLabel">credite Money</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <p>Are you sure you want to add this amount?</p>
                  <p id="modalPriceDisplay"></p>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                  <button type="button" class="btn btn-primary" id="confirmAddMoney" onclick="addMoneyToWallet()">credit
                    Money</button>
                </div>
              </div>
            </div>
          </div>
          <script>

          </script>

          <%- include('../layouts/user/footer.ejs') -%>


            <script>
              document.getElementById('openModalButton').addEventListener('click', function () {
                const priceInput = document.getElementById('priceInput');
                const modalPriceDisplay = document.getElementById('modalPriceDisplay');
                const modal = new bootstrap.Modal(document.getElementById('addMoneyModal'));

                // Display the entered price in the modal
                modalPriceDisplay.textContent = `Price: ₹${priceInput.value}`;

                // Open the modal
                modal.show();
              });

              document.getElementById('confirmAddMoney').addEventListener('click', function () {
                // Here you can add the logic to handle the "Add Money" action
                // For example, you might want to send the price to your server
                console.log('Adding money:', document.getElementById('priceInput').value);

                // Close the modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('addMoneyModal'));
                modal.hide();
              });

              // Optional: If you want to handle the close button click manually
              document.getElementById('closeModalButton').addEventListener('click', function () {
                const modal = bootstrap.Modal.getInstance(document.getElementById('addMoneyModal'));
                modal.hide();
              });



            </script>


            <script>
              function addMoneyToWallet() {
                const priceDisplayText = document.getElementById('modalPriceDisplay').textContent;
                // Assuming the price is always displayed as "Price: ₹<price>"
                const money = parseFloat(priceDisplayText.replace('Price: ₹', '').trim());
                console.log("price", money);
            
          

              fetch('/addMoneyTowallet', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                },
                body: JSON.stringify({ money }),
              }).then((response)=>{
                if(response.ok){
                  Swal.fire({
                    icon : 'success',
                    title : 'Cash successfully deposited',
                    showConfirmButton : false,
                    timer : 1500
                  }).then(()=>{
                    setTimeout(() => {
                      
                      window.location.reload()
                    }, 1);

                  })
                }else{
                  Swal.fire({
                    icon : 'error',
                    title : 'Try again something went wrong',
                    timer : 1500
                  })
                }
              })
              
            }
            </script>
            


            <!-- <script>
              function applyReferralCode(dupeCheck) {
                const referralCode = document.getElementById('referralCode').value
                if (referralCode.trim() === '') {
                  Swal.fire({
                    icon: 'error',
                    title: "Referral code cannot be empty.",
                    timer: 1500
                  })
                } else
                  if (referralCode === dupeCheck) {
                    Swal.fire({
                      icon: 'error',
                      title: "invalid referal code.",
                      timer: 1500
                    })
                  } else {
                    const data = {
                      referralCode: referralCode
                    }
                    fetch('/applyReferral', {
                      method: 'POST',
                      headers: {
                        'Content-Type': 'application/json'
                      },
                      body: JSON.stringify(data)
                    }).then((Response) => {
                      if (Response.ok) {
                        Swal.fire({
                          icon: 'success',
                          title: 'Successfully',
                          text: 'referral code cashback credited successfully',
                          timer: 1700
                        })
                      } else {
                        Swal.fire({
                          icon: 'error',
                          title: 'invalid referral code',
                          showConfirmButton: false,
                          timer: 1500
                        })
                      }
                    })
                  }
              }

              function copyReferralLink() {
                var referralLink = document.getElementById("referralLink");
                referralLink.select();
                document.execCommand("copy");
                alert('Referral link copied to clipboard!');
              }
              function copyReferralCode() {
                var rcode = document.getElementById("code");
                rcode.select();
                document.execCommand("copy");
                alert('Referral code copied to clipboard!');
              }

            </script> -->



            <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

            <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>